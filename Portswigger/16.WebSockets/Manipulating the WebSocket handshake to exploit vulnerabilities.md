# Lab: Manipulating the WebSocket handshake to exploit vulnerabilities

 This online shop has a live chat feature implemented using WebSockets.

It has an aggressive but flawed XSS filter.

To solve the lab, use a WebSocket message to trigger an alert() popup in the support agent's browser. 

**Hint**


    If you're struggling to bypass the XSS filter, try out our XSS labs.
    Sometimes you can bypass IP-based restrictions using HTTP headers like X-Forwarded-For.



# Step 1 

Find the websocket in the live chat, try to send a payload like `<img src=1 onerror=alert(1)>` and find that your ip gets blacklisted:

![image](https://user-images.githubusercontent.com/83407557/213062409-cd6c9830-3fe5-4eee-ba24-6c2dcf30f801.png)

# Step 2 Set up an X-Forwarded-For for an ip that isn't blocked:

![image](https://user-images.githubusercontent.com/83407557/213064283-9bc4e9b3-e29a-4388-8049-1bf33d0cac40.png)

Repeat the attempt but obfuscate the payload:

![image](https://user-images.githubusercontent.com/83407557/213065112-40ef2bf8-b238-4b4c-a2b3-94867c66fe6a.png)

Get blocked again:

![image](https://user-images.githubusercontent.com/83407557/213065283-5b7b75f5-e828-46b6-8943-18669006fa2e.png)

try to obfuscate the payload more:

```html
<img src=1 OnErRor=alert`1337`>
```
![image](https://user-images.githubusercontent.com/83407557/213065671-6b589c52-78ae-4dd6-812d-7bc33335aea7.png)

![image](https://user-images.githubusercontent.com/83407557/213065714-0751bc3f-0e0a-4475-9e59-cccc52cd75df.png)


Well, something broke....the lab isn't solved...just worked on something else an let the lab time out. Restarted and entered the same payload that worked:

![image](https://user-images.githubusercontent.com/83407557/213069109-a8a2ea1c-0fe5-4178-aee2-e3b18a00dc8d.png)

![image](https://user-images.githubusercontent.com/83407557/213069141-1c740bc0-e087-4dd2-87a5-efc88e1d85fc.png)



