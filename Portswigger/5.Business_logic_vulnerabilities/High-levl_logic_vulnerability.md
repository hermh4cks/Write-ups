# Lab: High-level logic vulnerability

 This lab doesn't adequately validate user input. You can exploit a logic flaw in its purchasing workflow to buy items for an unintended price. To solve the lab, buy a "Lightweight l33t leather jacket".

You can log in to your own account using the following credentials: wiener:peter 

# Step 1 Walk the application

I want to login with the account provided for the lab, and see the functionality of purchasing a l33t jacket:

![image](https://user-images.githubusercontent.com/83407557/209250500-34962bf0-538b-4715-8faa-71aac35fa457.png)

I add the jacket to cart, but capture the request

![image](https://user-images.githubusercontent.com/83407557/209250601-99ac9e6f-d714-4bae-b8f7-1f388eaa0150.png)

Not seeing any info on price, I try and see if I can modify the price when I capture the checkout button.

![image](https://user-images.githubusercontent.com/83407557/209250745-d17d9aa6-4fe5-4a74-9695-27b72be4867a.png)

However I don't see anything that can be modified and get an insufficient_funds error:

![image](https://user-images.githubusercontent.com/83407557/209250893-18c948fe-f3f5-4c4f-b49d-4e566c6ece26.png)

# Step 2 try and modify the coupon

![image](https://user-images.githubusercontent.com/83407557/209250979-a1372e9f-b5c0-4ce9-b823-a3f732259afe.png)

changing the value:

![image](https://user-images.githubusercontent.com/83407557/209251060-ca45b609-acb8-4ed2-9c7e-4d6426628921.png)

I get another error

# Step 3 Modify the remove from cart button:

![image](https://user-images.githubusercontent.com/83407557/209251614-c96a9548-f641-444e-9cb6-464fb84d491e.png)

changing quantity:

![image](https://user-images.githubusercontent.com/83407557/209251663-d5f9f897-c4b6-48c9-84f1-ad177d4a4ce2.png)

this ends up adding one

![image](https://user-images.githubusercontent.com/83407557/209251756-b6e33be2-4145-496f-8418-6b094ce4f56d.png)

Let's modify it again but change the redirect value to the checkout:

![image](https://user-images.githubusercontent.com/83407557/209251832-4d4e1bcd-ba51-4852-9f5b-5c74a3ef40de.png)

![image](https://user-images.githubusercontent.com/83407557/209251856-0920104e-ab43-47b2-afd5-1eb03154075a.png)

# Step 4 Adding a item with a different value, and changing product ID before it goes to cart:

![image](https://user-images.githubusercontent.com/83407557/209252062-61c06970-2f3d-480d-87a5-510b25569aa1.png)

Changing the ID to the ID of the jacket

![image](https://user-images.githubusercontent.com/83407557/209252137-ed6135b5-f2b0-42a4-9eb5-b693f1dd374b.png)

this still just adds the jacket

![image](https://user-images.githubusercontent.com/83407557/209252226-837d8482-10f9-47c2-9ef8-3e20ffae3942.png)


# Step 5 using a negative quantity to negate the value of the jacket

![image](https://user-images.githubusercontent.com/83407557/209252368-e531fd23-a932-4d82-b73e-383c5deddf6b.png)

I see that I now have a negative quantity and price:

![image](https://user-images.githubusercontent.com/83407557/209252616-050e1e9e-3e7e-4d07-9641-f85e38a6192d.png)

However if I try and checkout with a negative value I find that I get the following error:

![image](https://user-images.githubusercontent.com/83407557/209253509-49b61d0a-4ef0-406b-a845-8eeb28796e7a.png)


# Step 6 offset price with other items with negative values

If I go back to having a single jacket in my cart:

![image](https://user-images.githubusercontent.com/83407557/209253601-234be021-835a-4928-ae95-d69f9d56fdd8.png)

But then go back and add another item with multiple negative values, like this pool:

![image](https://user-images.githubusercontent.com/83407557/209253751-d8980d2c-dd2d-402a-9897-7326e44b4130.png)

I can do some math to figure out how many to add(subtract) to get a number that I can afford with my $100 store credit:

```bash
└─$ python -c 'print(94.52*14)'    
1323.28
```

So I add -14 pools:

![image](https://user-images.githubusercontent.com/83407557/209254200-6b353aed-1d8e-49bc-93ee-322868cfd929.png)

This makes it so that the total value is no longer a negative number:

![image](https://user-images.githubusercontent.com/83407557/209254317-86f4ad4e-01d4-4f43-9338-bf996e72ea48.png)

Now on checkout, I am able to get the jacket, and solve the lab:

![image](https://user-images.githubusercontent.com/83407557/209254392-6c53c4f0-aa08-4aed-812e-dc6041e3ca95.png)


