# Lab: Exploiting XInclude to retrieve files

 This lab has a "Check stock" feature that embeds the user input inside a server-side XML document that is subsequently parsed.

Because you don't control the entire XML document you can't define a DTD to launch a classic XXE attack.

To solve the lab, inject an XInclude statement to retrieve the contents of the /etc/passwd file. 

**HINT**

*By default, **XInclude** will try to parse the included document as XML. Since **/etc/passwd** isn't valid XML, you will need to add an extra attribute to the **XInclude** directive to change this behavior.* 

# Step 1 Walk the application's /product/stock page

Unlike the previous XXE labs, this /product/stock page is not directly passing XML to the back-end:

![image](https://user-images.githubusercontent.com/83407557/210471366-7be727ed-c0ad-4900-b96c-4f7b67603f8d.png)

# Step 2 Create an XInclude payload

Since I want to exfil the **/etc/passwd** file I will use the following XInclude payload:

```xml
<foo xmlns:xi="http://www.w3.org/2001/XInclude">
<xi:include parse="text" href="file:///etc/passwd"/></foo>
```

# Step 3 Test each parameter

I send the request to repeater and inject the payload into each parameter:

**ProductId**

![image](https://user-images.githubusercontent.com/83407557/210471828-528e5e0f-710e-42c2-a170-f7803d67f4b9.png)


**StoreId**

![image](https://user-images.githubusercontent.com/83407557/210471910-7a66cf31-028c-4f94-b513-4d75265ead2f.png)


I was only able to leak the /etc/passwd with the ProductId, but in doing so, solve the lab:

![image](https://user-images.githubusercontent.com/83407557/210472011-197a7e2a-2c81-43de-9284-c688157dbfab.png)
