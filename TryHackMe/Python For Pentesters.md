# Python For Pentesters

|Try Hack Me! Lab Write-up | By: Herman Detwiler | 8/5/21

## 1) Introduction

This lab teaches us to

- Use Python to enumerate the target's subdomain
- Build a simple keylogger
- Scan the network to find target systems
- Scan any target to find the open ports
- Download files from the internet
- Crack hashes




## 2) Subdomain Enumeration
 
*Python gives us an easy way to automate tasks during a penetration test. Any tasks that you have to perform regularly are worth automating. While the automation process comes with a learning curve, the mid and long-term gains are worth it.*

*Finding subdomains used by the target organization is an effective way to increase the attack surface and discover more vulnerabilities.*

*The script will use a list of potential subdomains and prepends them to the domain name provided via a command-line argument.*

*The script then tries to connect to the subdomains and assumes the ones that accept the connection exist.*


  ```python
#!/bin/bash/env python3

#Subdomain Enumeration Script for THMs PY4PT2 lab
#Writen by: Herman Detwiler

import requests
import sys

#open and read our wordlist	
subdomain_list = open("wordlist.txt").read()

#Split that content by each line and put it into a variable
subdoms = subdomain_list.splitlines()

#check to see if there is command-line input	
if len(sys.argv) < 2:
    print("Please enter a domain") #if not we tell them this
    sys.exit(1) #and exit our program

#For every sub domain in our split sub domains then trys to make http requests combining our list and input
for sub in subdoms:
	sub_domains = f"http://{sub}.{sys.argv[1]}"
	try:
		requests.get(sub_domains)

	except requests.ConnectionError:
		pass
	else:
		print("Valid Domain", sub_domains) #If it finds one it prints out that it found one and the name of that subdomain.
```

## 3) Directory Enumeration

*As it is often pointed out, reconnaissance is one of the most critical steps to the success of a penetration testing engagement. Once subdomains have been discovered, the next step would be to find directories.*

*The following code will build a simple directory enumeration tool.*

```python
#!/usr/bin/env python3


import requests
import sys

#reading our wordlist and putting it into a variable

sub_list = open("wordlist.txt").read()

#splitting each line of the file into another viable

directories = sub_list.splitlines()


#creating a for loop to iterate through each line

for dir in directories:
	dir_enum = f"http://{sys.argv[1]}/{dir}.html" #use an f string to store each request url
	r=requests.get(dir_enum) #send current request
	if r.status_code==404: #if the page doesn't exist
		pass
	else:
		print("Valid directory:" ,dir_enum) #if it does print this and the directory name
```

Running this command against the box provided by this room:

```bash
└─$ ./directory_enumeration.py $ip       
Valid directory: http://10.10.77.160/surfer.html
Valid directory: http://10.10.77.160/private.html
Valid directory: http://10.10.77.160/apollo.html
Valid directory: http://10.10.77.160/index.html
```
#### With this info we can see surfer is a notes page:

<h1>Notes for Matt</h1>

<h2>Passwords set are:</h2>
<ul>
	<li>Password for Madhatter set to MyCupOfTea</li>
	<li>Password for Rabbit set to LOUSYRABBO</li>
	<li>Password for Alice set to OnWithTheirHeads</li>
</ul>


<h2>Users created are:</h2>
<ul>
	<li>tiffany</li>
	<li>daniel</li>
	<li>jim</li>
	<li>mike</li>
</ul>

### private is a login page

<div class="container">
<div class="header">
  <h1>Sign in to your account below:</h1>
</div>

<form name="loginEmail" onsubmit="return validateForm();" method="post">
  
<ul>
<li>USERNAME: <input class="username" type="text" name="username">
</li>
   
<li>PASSWORD: <input class="password" type="text" name="password">
 </li>
</ul>
  

<input type="button" onclick="validateForm()" value="Display">  


  
</form>
  </div>



### Questions

1.  How many directories can your script identify on the target system? (extensions are .html):`4`

2.  What is the location of the login page?: `private.html`

3. 
